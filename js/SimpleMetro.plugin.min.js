!function(n,t){var o=[],e={};!function(){var t=["log","warn","info","error"];for(i=0;i<t.length;++i)n.console&&n.console[t[i]]?e[t[i]]=function(o){n.console[t[i]](o)}:(e[t[i]]=function(n){var t={};t[this.cmd_name]=n,o.push(t)},e[t[i]].cmd_name=t[i])}();var a=function(n,t,i){var o=function(n,t,i){var o=0,e=this;this.time_proc=function(){setTimeout(function(){Date.now()-o<t?e.time_proc():(o=0,i())},parseInt(t/10))},n.bind("resize",function(){Date.now()-o>=t&&(o=Date.now(),e.time_proc())})},e=new o(n,t,i);return e.time_proc},r=function(n){n&&n.container_style&&(n.container_style=t.extend(this.SimpleFliud.options.container_style,n.container_style)),n.wrapper=n.wrapper?n.wrapper:n.container,this._init(n)};r.prototype={options:{resize_duration:300,duration:500,panel_width:null,margin_cols:5,margin_row:5,container:null,wrapper:null,panel:"div",auto_width:!1,action_type:"immediately",animation_easing:"swing",container_style:{position:"relative"},event_onchange:function(){},event_afterchange:function(){}},container:null,wrapper:null,panels:[],maxYs:[],cols_num:0,panel_wrapper:function(n,i){var o=t(n);return o.change(function(){i()}),o},_init:function(i){var o=this;this.options=t.extend(this.options,i),this.options=this.options;var e=this.options;o.container=t(e.container),o.wrapper=e.wrapper==e.container?o.container:t(e.wrapper),(!e.panel_width||isNaN(e.panel_width))&&(e.panel_width=t(e.panel,o.container).filter(":first").outerWidth(!0));var r=a(t(n),e.resize_duration,function(){e.event_onchange(o),o._reloadContainer(e.event_afterchange)});t.each(t(e.panel,o.container),function(){o.panels.push(o.panel_wrapper(this,r))}),o.container.css({position:e.container_style.position});for(var s=0;s<o.panels.length;++s)o.panels[s].css({position:"absolute"});e.event_onchange(o),o._reloadContainer(e.event_afterchange)},_setContainerWidth:function(n,t){this.container.width()!=n&&(this.wrapper!=this.container?this._action(this.options.action_type).container.width(n,t):t&&"function"==typeof t&&t())},_calcColumns:function(n){var t=this;return Math.min(t.cols_num,Math.ceil((n-t.options.panel_width)/(t.options.panel_width+t.options.margin_row))+1)},_calcWidth:function(n){return n*this.options.panel_width+(n-1)*this.options.margin_cols},_reloadContainer:function(n){var t=this;t.options,t.cols_num=Math.floor((t.wrapper.innerWidth()-t.options.panel_width)/(t.options.panel_width+t.options.margin_row)+1);var i=t._calcWidth(t.cols_num);t._setContainerWidth(i,function(){t._reloadPanels(n),t._action(t.options.action_type).container.height(Math.max.apply(Math,t.maxYs.slice(0,t.maxYs.length))-t.options.margin_row)})},_setPanelPosition:function(n,t,i){var o=this;o.options.auto_width&&n.width(o._calcWidth(t.ce-t.c));for(var e=t.c;e<t.ce;++e)o.maxYs[e]=t.y+o.options.margin_row+n.outerHeight();o._action(o.options.action_type).panel.position(n,{left:t.c*(o.options.margin_cols+o.options.panel_width),top:t.y},i),i&&"function"==typeof i&&i()},_reloadPanels:function(n){var i=this;i.maxYs=[];for(var o=i.cols_num;o--;)i.maxYs.push(0);var e=0;t.each(i.panels,function(){var t=i._calcColumns(this.outerWidth()),o=i._getPosition(t);o.ce=t=o.c+t,i._setPanelPosition(this,o,function(){e++,e==i.panels.length&&n&&"function"==typeof n&&n()})})},_getPosition:function(n){if(n==this.cols_num)return{c:0,y:Math.max.apply(Math,this.maxYs)};for(var t=0,i=Math.max.apply(Math,this.maxYs.slice(0,n)),o=0;o+n<=this.cols_num;++o){var e=Math.max.apply(Math,this.maxYs.slice(o,o+n));i>e&&(t=o,i=e)}return{c:t,y:i}},_action:function(n){var t=this,i={immediately:{container:{width:function(n,i){i=i||function(){},t.container.width(n),i()},height:function(n,i){i=i||function(){},t.container.height(n),i()}},panel:{position:function(n,t,i){i=i||function(){},n.css({left:t.left,top:t.top}),i()}}},animation:{container:{width:function(n,i){i=i||function(){},t.container.stop().animate({width:n},t.options.duration,t.options.animation_easing,function(){i()})},height:function(n,i){i=i||function(){},t.container.stop().animate({height:n},t.options.duration,t.options.animation_easing,function(){i()})}},panel:{position:function(n,i,o){o=o||function(){},n.stop().animate({left:i.left,top:i.top},t.options.duration,t.options.animation_easing,function(){o()}),o()}}}};return i[n]}},t.SimpleFliud=function(n){return new r(n)},t.fn.SimpleFliud=function(n){n.container=this.selector,t.SimpleFliud(n)}}(window,jQuery);